- home https://ipset.netfilter.org/
  - Author: Jozsef Kadlesick
  - requires a kernel module ~ip_set~
  - iptables focused (NOT nftables)
  - If you want to
    1) STORE multiple IP addresses or port numbers and match against the collection by ~iptables~ at one swoop
    2) dynamically UPDATE ~iptables~ rules against IP addresses or ports without performance penalty
    3) express complex IP address and ports based rulesets with one single ~iptables~ rule and benefit from the speed of IP sets
  - can store these, or a combination of them (comma separated)
    * (ip)s
    * (net)works
    * (port) numbers
    * (mac) addresses
    * (iface) interface names
  - using one of these methods
    * bitmap
    * hash
    * list

- man https://ipset.netfilter.org/ipset.man.html
- https://ipset.netfilter.org/iptables-extensions.man.html

|------------------------------+---------------------------------|
| create   SNAME  METHOD:STYPE |                                 |
| add      SNAME  ENTRY        |                                 |
| del      SNAME  ENTRY        |                                 |
| swap     SNAME1 SNAME2       |                                 |
| destroy [SNAME]              |                                 |
| save    [SNAME]              | prints to STDOUT current config |
| restore                      | reads STDIN and restores config |
|------------------------------+---------------------------------|

* snippets

- Converts PG2 IP Blocklists into lists that ipset can consume
  https://github.com/ilikenwf/pg2ipset
  https://github.com/ilikenwf/pg2ipset/blob/master/ipset-update.sh

- BAN multiple country IPS's using ipset
  https://github.com/andrei821/ip-ban

- A bash script to ban large numbers of IP addresses published in blacklists.
  https://github.com/trick77/ipset-blacklist

- https://mywiki.wooledge.org/HelpOnSpam (see if you need to change /etc/sysconfig/iptables-config)
  #+begin_src sh
    # Timeout after 300 days (adjust timeout and maxelem as necessary)
    ipset create wikispam hash:ip \
          -exist \
          family inet hashsize 16384 \
          maxelem 65536 timeout 25920000

    # Drop if on the spam list (within the configured time period)
    iptables -A INPUT \
             -p tcp --dport 80 \
             -m set --match-set wikispam src -j DROP
  #+end_src


* articles

- 12 article | Advanced Firewall Configurations with ipset https://www.linuxjournal.com/content/advanced-firewall-configurations-ipset
- 15 article | https://wiki.nikhil.io/Ipset_Notes/
- 15 article | Unexpected DDOS: Blocking China with ipset and iptables https://web.archive.org/web/20160215153057/https://mattwilcox.net/web-development/unexpected-ddos-blocking-china-with-ipset-and-iptables/
- 16 article | ipset service https://www.epilis.gr/en/blog/2016/08/07/ipset-service/
- 20 article | Create iptables Rules Based on Hostname Using an IPSet https://www.putorius.net/ipset-iptables-rules-for-hostname.html
- 20 article | Performance Benchmark Analysis of Egress Filtering on Linux https://kinvolk.io/blog/2020/09/performance-benchmark-analysis-of-egress-filtering-on-linux/
- 21 article | ipset to nftables https://wiki.nftables.org/wiki-nftables/index.php/Moving_from_ipset_to_nftables
- 22 article | Block web scanners with ipset & iptables https://nbailey.ca/post/block-scanners/

- wiki ipfire https://www.ipfire.org/docs/configuration/firewall/ipset

** wiki arch

https://wiki.archlinux.org/title/Ipset

- $ ipset save > /etc/ipset.conf
- there is a systemd ~ipset.service~ that should be enabled to read saved config

** wiki gentoo

https://wiki.gentoo.org/wiki/IPSet

- discussion https://forums.gentoo.org/viewtopic-t-863121.html
- there is a openrc? service
  #+begin_src
    # /etc/init.d/ipset save
    # /etc/init.d/ipset start
    # /etc/inid.d/ipset boot
    # iptables -I INPUT -m set --match-set IPBlock src,dst -j Drop
  #+end_src
- Kernel configuration
  - Networking support
    Networking options
    Netfilter
    <M> Ip set support
    Core Netfilter configuration
    <M> set target and match support

* videos

** 17 video | firewalld rich rules and IPset

"Advanced Linux firewall config. with firewalld rich rules and IPset - rich rules + ipset"
https://www.youtube.com/watch?v=tt2-M8CVgx4

** 16 video | faster, more efficient firewalling with iptables

"Netdev 1.1 - Ipset - a tool for faster, more efficient firewalling with iptables"
https://www.youtube.com/watch?v=dMz9A4Jh0_c

** TODO 14 video | ipset                     | Rob Townley

https://www.youtube.com/watch?v=5eKjNOolD00

- Shorewall? had a similar tool

- not totally stable?
  - for him the "$ ipset add SNAME range" stopped working

- =hosts.deny= and =hosts.allow= only works with the programs that use it

- you might have an error on your iptables, if the *ipset* it references doesn't exist

- Centos iptables config
  /etc/sysconfig/iptables-config
  /etc/sysconfig/iptables (generated by iptables-save)

- $ rpm -q --changelog ipset

- 20:00
